apply plugin: 'com.android.application'

android {
    compileSdkVersion 26
    defaultConfig {
        applicationId "xxxxxx"
        minSdkVersion 15
        targetSdkVersion 22
        versionCode 1
        versionName "1.0"
        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
    }

    signingConfigs {
        release {
            storeFile file('../keystore/release.keystore')
            storePassword getProperty('store.password', 'STORE_PASSWORD')
            keyAlias getProperty('store.key.alias', 'KEY_ALIAS')
            keyPassword getProperty('store.key.password', 'KEY_PASSWORD')
        }
    }

    buildTypes {
        release {
            signingConfig signingConfigs.release
            minifyEnabled true
            //Zipalign优化
            zipAlignEnabled true
            // 移除无用的resource文件
            shrinkResources true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }

        travis {
            initWith release
            signingConfig signingConfigs.debug
        }
    }

    applicationVariants.all { variant ->
        variant.outputs.all { output ->
            outputFileName = String.format('%s_%s_%s_%s.apk', 'Pretty', getVersionName(), getDate(), variant.buildType.name)
        }
    }
}

def getDate() {
    return new Date().format('yyyyMMdd', TimeZone.getTimeZone('GMT+8'))
}

def getVersionName() {
    return 'v' + android.defaultConfig.versionName
}

def getProperty(String propertyName, String envName) {
    try {
        def property = project.hasProperty(propertyName) ? project.property(propertyName) : System.getenv(envName)
        if (property == null) {
            throw new NullPointerException();
        }
        return property
    } catch (Throwable ignored) {
        def message = String.format('********************************************************************************\n' +
                'You need define %s in gradle.properties or set environment variable: %s\n' +
                '********************************************************************************\n', propertyName, envName)
        throw new RuntimeException(message)
    }
}

dependencies {
    implementation "com.android.support:appcompat-v7:$support_library_version"

    implementation project(':easypermissions')
}

